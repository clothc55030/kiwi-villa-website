---
import Layout from '../layouts/Layout.astro';

const pageTitle = '常見問題 - 澎湖期遇度假會館 | 專業解答您的疑問';
const pageDescription = '澎湖期遇度假會館常見問題解答，包含房價說明、設施服務、訂房須知等詳細資訊，為您的澎湖之旅提供完整指引。';
const canonicalURL = 'https://www.kiwi-villa.com/faq';

// 定義 FAQ 資料結構的類型
interface FaqSection {
  title?: string;
  list?: string[];
  text?: string;
}

interface FaqAnswer {
  intro?: string;
  details?: string;
  list?: string[];
  sections?: FaqSection[];
  conclusion?: string;
}

interface Faq {
  id: string;
  question: string;
  answer: FaqAnswer;
}

// FAQ 資料
const faqs: Faq[] = [
  {
    id: 'price',
    question: '為什麼我們房價比周圍的都貴？',
    answer: {
      intro: '簡單來說：我們的建造成本、早餐成本、備品成本、布草成本都比別人高，也可以自信的說比別人好！',
      details: '詳細來講：',
      list: [
        '建材用料：民宿本身主體結構、建材、油漆用料這些看不到的東西，都用料實在',
        '裝潢設計：雖然不像網美民宿如此浮誇，但是整體風格一致，細節豐滿',
        '早餐品質：請參考各大平台旅客們的評價',
        '床組用品：床單被單皆採用 100 支全棉製品，極致的親膚感（我們沒有賣，可自行查詢相關規格採購）'
      ],
      conclusion: '我們明碼標價，需要任何照片皆可跟小編索取，若是價格不合適，真的不勉強訂房！'
    }
  },
  {
    id: 'sea-view',
    question: '民宿有海景嗎？',
    answer: {
      intro: '民宿每一間都沒有海景，但是都有落地窗跟獨立陽台。'
    }
  },
  {
    id: 'whole-house',
    question: '民宿可以包棟嗎？',
    answer: {
      intro: '我們並非專營包棟民宿，主人都是自住裡面的，請加 LINE 詢問包棟規定，如果能接受是可以包全部房間的。',
      details: '注意事項：',
      list: [
        '民宿比較大間，一共可以住 25 位',
        '不適合 15 位以下的包棟'
      ]
    }
  },
  {
    id: 'bbq-mahjong',
    question: '民宿可以烤肉、打麻將嗎？',
    answer: {
      sections: [
        {
          title: '關於麻將：',
          list: [
            '我們不提供麻將桌以及麻將',
            '民宿桌子為大理石板，若是要自帶麻將請維護桌面，避免損毀'
          ]
        },
        {
          title: '關於烤肉：',
          list: [
            '即使包棟也不能烤肉！',
            '真的想吃烤肉，我們可以請外燴業者上門為您服務（可私訊我們了解詳情）'
          ]
        }
      ]
    }
  },
  {
    id: 'facilities',
    question: '民宿有提供什麼設施嗎？',
    answer: {
      sections: [
        {
          title: '住宿設施：',
          list: [
            '舒服的大床',
            '好睡的棉被',
            '全採用 TOTO 的衛浴設備及免治馬桶'
          ]
        },
        {
          title: '館內設施：',
          list: [
            '電梯（方便攜帶行李）',
            '一樓舒適的公共空間',
            '100 吋大熒幕影視設備',
            '頂樓戲水池（3m × 6m）'
          ]
        }
      ]
    }
  },
  {
    id: 'breakfast',
    question: '民宿提供的早餐是什麼樣的？',
    answer: {
      sections: [
        {
          title: '早餐規格：',
          list: [
            '一人一份中式早餐',
            '用餐時間：8:30-10:00'
          ]
        },
        {
          title: '特殊需求：',
          text: '若是要配合出海行程提前用餐，請提前一天 21:00 前通知，我們會為您提早準備可外帶的早餐。'
        }
      ]
    }
  },
  {
    id: 'booking-services',
    question: '民宿可以代訂機票、船票、包套行程嗎？',
    answer: {
      sections: [
        {
          title: '機票服務：',
          list: [
            '人數不多的情況下，建議自行到華信、立榮官網訂票，後續若有需要退改會比較方便',
            '團體的部分，我們有配合的旅行社可以協助處理'
          ]
        },
        {
          title: '行程規劃：',
          list: [
            '旅客在完成訂房後，我們會提供詳細行程咨詢',
            '全程有任何問題皆可詢問',
            '若需要協助安排，會提前詢問您們的需求，然後幫您介紹並規劃好行程',
            '如果滿意再幫您跟行程的業者下訂'
          ]
        },
        {
          title: '船票服務：',
          text: '有配合旅行社代訂船票，需要請加 LINE 咨詢。'
        }
      ]
    }
  },
  {
    id: 'special-offer',
    question: '有什麼特別優惠嗎？',
    answer: {
      sections: [
        {
          title: '特別優惠：',
          text: '若您確實有閱讀完民宿相關規定，並以匯訂金方式訂房者，請聯繫訂房小編，會給您額外優惠（僅限匯款前告知）。'
        }
      ]
    }
  },
  {
    id: 'transportation',
    question: '澎湖適合開汽車還是騎機車呢？',
    answer: {
      sections: [
        {
          title: '機車優點：',
          list: [
            '費用較低',
            '一群人出遊可以不需要集體行動'
          ]
        },
        {
          title: '汽車優點：',
          list: [
            '比較涼快，不會被曬',
            '除了花火施放時間市區不好停車外，其餘景點都很好停車'
          ]
        }
      ],
      conclusion: '請自行考慮選擇最適合您的交通方式。'
    }
  }
];

// 生成 FAQ Schema.org 結構化資料
const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqs.map(faq => ({
    "@type": "Question",
    "name": faq.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": (() => {
        let text = '';
        if (faq.answer.intro) {
          text += faq.answer.intro + ' ';
        }
        if (faq.answer.details) {
          text += faq.answer.details + ' ';
        }
        if (faq.answer.list) {
          text += faq.answer.list.join('; ') + ' ';
        }
        if (faq.answer.sections) {
          faq.answer.sections.forEach(section => {
            if (section.title) {
              text += section.title + ' ';
            }
            if (section.list) {
              text += section.list.join('; ') + ' ';
            }
            if (section.text) {
              text += section.text + ' ';
            }
          });
        }
        if (faq.answer.conclusion) {
          text += faq.answer.conclusion;
        }
        return text.trim();
      })()
    }
  }))
};
---

<Layout 
  title={pageTitle}
  description={pageDescription}
  ogImage="https://www.kiwi-villa.com/images/faq/faq-og.webp"
  keywords="澎湖期遇度假會館,常見問題,FAQ,訂房須知,民宿設施,房價說明,澎湖民宿,旅遊諮詢"
>
  <!-- Schema.org FAQ 結構化資料 -->
  <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
  <!-- Hero Section - 使用與 intro 頁面相同的設計 -->
  <section class="relative min-h-[70vh] md:min-h-[80vh] flex items-center justify-center overflow-hidden animate-gradient-shift" 
           style="background: linear-gradient(135deg, #7c9bb5 0%, #9bb0c4 25%, #b8c7d6 50%, #a8b8c8 75%, #8fa3b3 100%); background-size: 400% 400%;">
    <div class="absolute inset-0 bg-gradient-to-b from-black/10 via-transparent to-black/20"></div>
    
    <div class="relative z-10 text-center text-white px-6 py-12 max-w-5xl mx-auto">
      <h1 class="font-display text-[clamp(2.5rem,5vw,4rem)] font-bold mb-6 text-shadow-md animate-fade-in-up">
        常見問題解答
      </h1>
      <p class="text-[clamp(1.125rem,2.5vw,1.5rem)] font-light mb-8 text-shadow-sm animate-fade-in-up animate-delay-200">
        我們整理了您最關心的問題
      </p>
      <div class="max-w-3xl mx-auto space-y-4 animate-fade-in-up animate-delay-400">
        <p class="text-[1.1rem] leading-relaxed text-white/90 text-shadow-sm">
          無論是關於住宿設施、預訂流程，還是周邊旅遊資訊，
        </p>
        <p class="text-[1.1rem] leading-relaxed text-white/90 text-shadow-sm">
          我們都為您準備了詳盡的解答。如有其他疑問，歡迎隨時與我們聯繫。
        </p>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <main class="py-16 md:py-24">
    <div class="container mx-auto px-4">
      <!-- FAQ Grid - 重新設計為卡片網格 -->
      <div class="max-w-6xl mx-auto">
        <div class="grid gap-6" id="faq-container">
          {faqs.map((faq, index) => (
            <article 
              class="faq-item group bg-white rounded-2xl shadow-md hover:shadow-xl transition-all duration-500 overflow-hidden" 
              data-animate 
              data-animate-delay={`${Math.min(index * 50, 300)}`}
            >
              <!-- 問題標題 - 使用漸層背景 -->
              <button 
                class="faq-button relative w-full px-8 py-6 text-left bg-gradient-to-r from-gray-50 to-white hover:from-primary/5 hover:to-secondary/5 transition-all duration-300 group"
                aria-expanded="false"
                aria-controls={`answer-${faq.id}`}
              >
                <div class="flex items-start justify-between gap-4">
                  <h3 class="text-lg md:text-xl font-semibold-cn text-gray-800 group-hover:text-primary transition-colors pr-4">
                    {faq.question}
                  </h3>
                  <div class="flex-shrink-0 mt-1">
                    <div class="faq-icon-wrapper w-10 h-10 rounded-full bg-gray-100 group-hover:bg-primary/10 flex items-center justify-center transition-all duration-300">
                      <iconify-icon 
                        icon="heroicons:plus" 
                        class="faq-icon-plus w-6 h-6 text-gray-600 group-hover:text-primary transition-all duration-300"
                      ></iconify-icon>
                      <iconify-icon 
                        icon="heroicons:minus" 
                        class="faq-icon-minus w-6 h-6 text-primary hidden"
                      ></iconify-icon>
                    </div>
                  </div>
                </div>
              </button>
              
              <!-- 答案內容 - 優化排版 -->
              <div 
                id={`answer-${faq.id}`}
                class="faq-answer max-h-0 overflow-hidden transition-all duration-500 ease-in-out"
              >
                <div class="px-8 pb-8 pt-0">
                  <div class="prose prose-gray max-w-none">
                    {faq.answer.intro && (
                      <p class="text-gray-700 leading-relaxed font-medium-cn mb-4">
                        {faq.answer.intro}
                      </p>
                    )}
                    
                    {faq.answer.details && (
                      <p class="text-gray-800 font-semibold-cn mb-3">
                        {faq.answer.details}
                      </p>
                    )}
                    
                    {faq.answer.list && (
                      <ul class="space-y-3">
                        {faq.answer.list.map(item => (
                          <li class="flex items-start gap-3">
                            <iconify-icon 
                              icon="heroicons:check-circle" 
                              class="w-5 h-5 text-primary mt-0.5 flex-shrink-0"
                            ></iconify-icon>
                            <span class="text-gray-700 leading-relaxed">
                              {item.includes('：') ? (
                                <>
                                  <strong class="font-semibold-cn text-gray-800">{item.split('：')[0]}：</strong>
                                  {item.split('：')[1]}
                                </>
                              ) : item}
                            </span>
                          </li>
                        ))}
                      </ul>
                    )}
                    
                    {faq.answer.sections && faq.answer.sections.map((section, sectionIndex) => (
                      <div class={sectionIndex > 0 ? 'mt-6' : ''}>
                        {section.title && (
                          <p class="text-gray-800 font-semibold-cn mb-3">
                            {section.title}
                          </p>
                        )}
                        {section.list && (
                          <ul class="space-y-3">
                            {section.list.map(item => (
                              <li class="flex items-start gap-3">
                                <iconify-icon 
                                  icon="heroicons:arrow-right-circle" 
                                  class="w-5 h-5 text-secondary mt-0.5 flex-shrink-0"
                                ></iconify-icon>
                                <span class="text-gray-700 leading-relaxed">{item}</span>
                              </li>
                            ))}
                          </ul>
                        )}
                        {section.text && (
                          <p class="text-gray-700 leading-relaxed mt-3">
                            {section.text}
                          </p>
                        )}
                      </div>
                    ))}
                    
                    {faq.answer.conclusion && (
                      <div class="mt-6 p-4 bg-gray-50 rounded-lg border-l-4 border-primary">
                        <p class="text-gray-700 font-medium-cn">
                          {faq.answer.conclusion}
                        </p>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </article>
          ))}
        </div>

        <!-- CTA Section - 重新設計 -->
        <section class="mt-24 relative" data-animate>
          <div class="relative bg-gradient-to-br from-primary via-secondary to-accent rounded-3xl overflow-hidden shadow-2xl">
            <!-- 動態背景圖案 -->
            <div class="absolute inset-0 opacity-20">
              <div class="absolute -top-10 -right-10 w-40 h-40 bg-white/20 rounded-full blur-3xl"></div>
              <div class="absolute -bottom-10 -left-10 w-60 h-60 bg-white/20 rounded-full blur-3xl"></div>
            </div>
            
            <!-- 內容 -->
            <div class="relative z-10 p-12 md:p-16 text-center">
              <iconify-icon 
                icon="heroicons:chat-bubble-left-right" 
                class="w-16 h-16 text-white/80 mx-auto mb-6"
              ></iconify-icon>
              <h2 class="text-3xl md:text-4xl font-display font-bold text-white mb-6 text-shadow-lg">
                還有其他問題嗎？
              </h2>
              <p class="text-lg md:text-xl text-white/90 mb-10 max-w-2xl mx-auto text-shadow-md">
                我們的專業團隊隨時為您服務，讓我們為您的澎湖之旅提供最貼心的建議
              </p>
              
              <!-- 聯絡按鈕 -->
              <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a 
                  href="https://page.line.me/ucz4004x" 
                  target="_blank" 
                  rel="noopener noreferrer" 
                  class="group inline-flex items-center justify-center px-8 py-4 bg-white text-gray-800 rounded-full font-medium-cn text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300"
                >
                  <iconify-icon 
                    icon="simple-icons:line" 
                    class="w-6 h-6 text-green-500 mr-3 group-hover:scale-110 transition-transform"
                  ></iconify-icon>
                  透過 LINE 聯絡我們
                </a>
                <a 
                  href="tel:+88669272755" 
                  class="group inline-flex items-center justify-center px-8 py-4 bg-white/10 backdrop-blur-sm text-white border-2 border-white/30 rounded-full font-medium-cn text-lg hover:bg-white/20 hover:border-white/50 transform hover:-translate-y-1 transition-all duration-300"
                >
                  <iconify-icon 
                    icon="heroicons:phone" 
                    class="w-6 h-6 mr-3 group-hover:scale-110 transition-transform"
                  ></iconify-icon>
                  電話聯繫
                </a>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const faqButtons = document.querySelectorAll('.faq-button');
      
      faqButtons.forEach(button => {
        button.addEventListener('click', () => {
          const faqItem = button.parentElement as HTMLElement | null;
          if (!faqItem) return;

          const answer = faqItem.querySelector('.faq-answer') as HTMLElement | null;
          const iconPlus = button.querySelector('.faq-icon-plus');
          const iconMinus = button.querySelector('.faq-icon-minus');
          const isExpanded = button.getAttribute('aria-expanded') === 'true';

          if (!answer || !iconPlus || !iconMinus) return;
          
          if (isExpanded) {
            button.setAttribute('aria-expanded', 'false');
            answer.style.maxHeight = '0';
            iconPlus.classList.remove('hidden');
            iconMinus.classList.add('hidden');
            faqItem.classList.remove('shadow-xl', 'ring-2', 'ring-primary/20');
          } else {
            faqButtons.forEach(otherButton => {
              if (otherButton !== button) {
                const otherItem = otherButton.parentElement as HTMLElement | null;
                if (!otherItem) return;
                const otherAnswer = otherItem.querySelector('.faq-answer') as HTMLElement | null;
                const otherIconPlus = otherButton.querySelector('.faq-icon-plus');
                const otherIconMinus = otherButton.querySelector('.faq-icon-minus');
                
                if (otherAnswer && otherIconPlus && otherIconMinus) {
                  otherButton.setAttribute('aria-expanded', 'false');
                  otherAnswer.style.maxHeight = '0';
                  otherIconPlus.classList.remove('hidden');
                  otherIconMinus.classList.add('hidden');
                  otherItem.classList.remove('shadow-xl', 'ring-2', 'ring-primary/20');
                }
              }
            });
            
            button.setAttribute('aria-expanded', 'true');
            answer.style.maxHeight = answer.scrollHeight + 'px';
            iconPlus.classList.add('hidden');
            iconMinus.classList.remove('hidden');
            faqItem.classList.add('shadow-xl', 'ring-2', 'ring-primary/20');
            
            setTimeout(() => {
              faqItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
          }
        });
      });
    });

    import('motion').then(({ animate }) => {
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const target = entry.target as HTMLElement;
            const delay = parseInt(target.dataset.animateDelay || '0', 10);
            
            setTimeout(() => {
              animate(target, 
                { opacity: [0, 1], y: [20, 0] },
                { duration: 0.6, easing: 'ease-out' }
              );
            }, delay);
            
            observer.unobserve(target);
          }
        });
      }, observerOptions);

      document.querySelectorAll<HTMLElement>('[data-animate]').forEach(el => {
        el.style.opacity = '0';
        observer.observe(el);
      });
    }).catch(console.error);
  </script>
</Layout>