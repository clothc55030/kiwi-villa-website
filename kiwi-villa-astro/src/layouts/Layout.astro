---
import '../styles/globals.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

export interface Props {
	title: string;
	description: string;
	ogImage?: string;
	canonicalUrl?: string;
	structuredData?: object;
}

const { 
	title = '澎湖期遇度假會館 - 澎湖民宿推薦 | 三面環海歐風建築度假首選',
	description = '澎湖期遇度假會館，座落於三面環海半島，融合歐洲巴洛克古典建築美學。在陽光海洋微風星光中，開啟您的期遇之旅，體驗潮流與經典融合的海島度假時光。',
	ogImage = 'https://www.kiwi-villa.com/assets/og-image.webp',
	canonicalUrl = 'https://www.kiwi-villa.com/',
	structuredData
} = Astro.props;
---

<!DOCTYPE html>
<html lang="zh-TW" class="scroll-smooth">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>{title}</title>
		<meta name="description" content={description} />
		<meta name="keywords" content="澎湖民宿推薦,澎湖期遇度假會館,澎湖住宿,三面環海,歐洲巴洛克建築,澎湖旅遊,海島度假,澎湖民宿" />
		
		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website">
		<meta property="og:url" content={canonicalUrl}>
		<meta property="og:title" content={title}>
		<meta property="og:description" content={description}>
		<meta property="og:image" content={ogImage}>
		
		<!-- Twitter -->
		<meta property="twitter:card" content="summary_large_image">
		<meta property="twitter:url" content={canonicalUrl}>
		<meta property="twitter:title" content={title}>
		<meta property="twitter:description" content={description}>
		<meta property="twitter:image" content={ogImage}>
		
		<!-- Favicon -->
		<link rel="icon" type="image/x-icon" href="/images/logo/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/logo/favicon-16x16.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/images/logo/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="96x96" href="/images/logo/favicon-96x96.png">
		<link rel="icon" type="image/png" sizes="192x192" href="/images/logo/favicon-192x192.png">
		<link rel="icon" type="image/png" sizes="512x512" href="/images/logo/favicon-512x512.png">
		<link rel="apple-touch-icon" sizes="57x57" href="/images/logo/apple-touch-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/images/logo/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/images/logo/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/images/logo/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/images/logo/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/images/logo/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/images/logo/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/images/logo/apple-touch-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/images/logo/apple-touch-icon-180x180.png">
		<link rel="manifest" href="/manifest.json">
		
		<!-- Google Fonts with optimization -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link 
			href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;400;500;600;700&family=Lora:ital,wght@0,400;0,500;0,600;1,400&family=Noto+Sans+TC:wght@300;400;500;700&display=swap&subset=chinese-traditional" 
			rel="stylesheet"
			media="print" 
			onload="this.media='all'"
		/>
		<noscript>
			<link 
				href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;400;500;600;700&family=Lora:ital,wght@0,400;0,500;0,600;1,400&family=Noto+Sans+TC:wght@300;400;500;700&display=swap&subset=chinese-traditional" 
				rel="stylesheet"
			/>
		</noscript>
		
		<!-- Canonical URL -->
		<link rel="canonical" href={canonicalUrl} />
		
		<!-- Structured Data -->
		{structuredData && (
			<script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
		)}
		
		<!-- Critical CSS (僅保留真正關鍵的樣式以防止 FOUC) -->
		<style>
			/* 最小化的關鍵 CSS - 其餘樣式已在 globals.css 中定義 */
			:root {
				--color-primary: #7c9bb5;
				--color-text-primary: #4a453f;
				--color-bg-primary: #ffffff;
			}
			
			/* 防止無樣式內容閃爍 (FOUC) */
			body {
				opacity: 0;
				transition: opacity 0.3s ease;
			}
			
			body.loaded {
				opacity: 1;
			}
		</style>
		
		<script>
			// 防止 FOUC - 在樣式載入完成後顯示內容
			document.addEventListener('DOMContentLoaded', () => {
				document.body.classList.add('loaded');
			});
		</script>
		
		<!-- 預載入關鍵資源 - 預載入 AVIF 格式（瀏覽器優先使用的格式） -->
		<link rel="preload" as="image" href="/images/hero/main-hall-environment-mobile-extreme.avif" type="image/avif" media="(max-width: 768px)" />
		<link rel="preload" as="image" href="/images/hero/main-hall-environment-new.avif" type="image/avif" media="(min-width: 769px)" />
		
		<!-- DNS 預取 -->
		<link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
		
		<!-- 資源提示 -->
		<meta name="theme-color" content="#7c9bb5" />
		<meta name="color-scheme" content="light" />
	</head>
	<body class="font-sans">
		<Header />
		<main>
			<slot />
		</main>
		<Footer />
		
		<!-- 延遲載入非關鍵腳本 -->
		<script type="module">
			// 性能監測（只在開發環境執行）
			if ('PerformanceObserver' in window && import.meta.env.DEV) {
				// LCP 監測
				const lcpObserver = new PerformanceObserver((list) => {
					const entries = list.getEntries();
					const lastEntry = entries[entries.length - 1];
					// 使用特殊的日誌函數避免被 terser 移除
					if (window.console && window.console.info) {
						window.console.info('LCP:', lastEntry.startTime);
					}
				});
				lcpObserver.observe({ type: 'largest-contentful-paint', buffered: true });
				
				// FID 監測
				const fidObserver = new PerformanceObserver((list) => {
					for (const entry of list.getEntries()) {
						if (window.console && window.console.info) {
							window.console.info('FID:', entry.processingStart - entry.startTime);
						}
					}
				});
				fidObserver.observe({ type: 'first-input', buffered: true });
			}
		</script>
	</body>
</html> 